"use strict";
/*
 * @Author: he@whaleblue.design
 * @Date: 2018-07-14 22:46:40
 * @Last Modified by: Mr.He
 * @Last Modified time: 2018-07-17 22:27:33
 * @content what is the content of this file. */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const config_1 = require("config/config");
const db_1 = require("common/db");
const cache_1 = require("common/cache");
const _ = require("lodash");
/* init DB, import table models. */
db_1.init(config_1.config.mysql.url, config_1.config.mysql.debug);
require("sqlModel/index");
db_1.DB.sync({ force: false });
/* inject redis server. */
cache_1.default.init(config_1.config.redis.url);
const http_1 = require("../http");
const superkoa = require('superkoa');
const bootup = superkoa(http_1.default);
const HTTP_OK = 200;
const HTTP_ERR = 500;
const assert = require("assert");
describe('#the image captcha test', function () {
    let codeIdBody, codeIdData;
    before((() => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let result = yield bootup.get("/api/v1/captchaid").expect(HTTP_OK);
        codeIdBody = result.body;
        codeIdData = codeIdBody.data;
    })));
    it("get the code ID", (done) => {
        assert.equal(codeIdBody.code, 0);
        assert.ok(codeIdData.codeId);
        done();
    });
    it("get the captcha picture", () => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let result = yield bootup.get("/api/v1/captchaimg/" + codeIdData.codeId).expect(HTTP_OK);
        assert.equal(result.headers["content-type"], "image/gif");
    }));
});
describe('#post user', function () {
    let codeId, code, data;
    before((() => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let result = yield bootup.get("/api/v1/captchaid").expect(HTTP_OK);
        codeId = result.body.data.codeId;
        let imgresult = yield bootup.get("/api/v1/captchaimg/" + codeId).expect(HTTP_OK);
        assert.equal(imgresult.headers["content-type"], "image/gif");
        let redisCache = yield cache_1.default.read(codeId);
        code = redisCache.code;
        data = {
            "email": Math.random() + "abc123@163.com",
            "address": ["dfdf", "dfdfdf", "dfdfdfjdljc", "aa", "b"],
            "twtterName": "ddf",
            "radditName": "dfdf",
            "facebookName": "ok",
            "firstName": "o122",
            "lastName": "last",
            "country": "country12",
            "code": code,
            "codeId": codeId,
            "checkMarketing": 1
        };
    })));
    it("the params require check", () => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let theData = _.cloneDeep(data);
        delete theData.twtterName;
        let result = yield bootup.post("/api/v1/users")
            .send(theData)
            .expect(HTTP_OK);
        assert.notEqual(result.body.code, 0);
    }));
    it("the params address check", () => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let theData = _.cloneDeep(data);
        theData.address = [];
        let result = yield bootup.post("/api/v1/users")
            .send(theData)
            .expect(HTTP_OK);
        assert.notEqual(result.body.code, 0);
        theData.address = ["1", "2", "3", "4", "5", "6"];
        let result2 = yield bootup.post("/api/v1/users")
            .send(theData)
            .expect(HTTP_OK);
        assert.notEqual(result.body.code, 0);
    }));
    it("the user create success", () => tslib_1.__awaiter(this, void 0, void 0, function* () {
        let result = yield bootup.post("/api/v1/users")
            .send(data)
            .expect(HTTP_OK);
        assert.equal(result.body.code, 0);
    }));
    it("the same code can't be post again.", () => tslib_1.__awaiter(this, void 0, void 0, function* () {
        data.email = "dfdfdfdfdfdfdfdf@qq.com";
        let result = yield bootup.post("/api/v1/users")
            .send(data)
            .expect(HTTP_OK);
        assert.notEqual(result.body.code, 0);
    }));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QvbWFpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O2dEQUtnRDs7O0FBR2hELDBDQUF1QztBQUN2QyxrQ0FBcUM7QUFDckMsd0NBQWlDO0FBQ2pDLDRCQUE0QjtBQUU1QixtQ0FBbUM7QUFDbkMsU0FBSSxDQUFDLGVBQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLGVBQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0MsMEJBQXdCO0FBQ3hCLE9BQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUUxQiwwQkFBMEI7QUFDMUIsZUFBSyxDQUFDLElBQUksQ0FBQyxlQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBRTdCLGtDQUEwQjtBQUMxQixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUE7QUFDcEMsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQUcsQ0FBQyxDQUFDO0FBQzdCLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQztBQUNwQixNQUFNLFFBQVEsR0FBRyxHQUFHLENBQUM7QUFHckIsaUNBQWlDO0FBQ2pDLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRTtJQUVoQyxJQUFJLFVBQVUsRUFBRSxVQUFVLENBQUM7SUFDM0IsTUFBTSxDQUFDLENBQUM7UUFDSixJQUFJLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbkUsVUFBVSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDekIsVUFBVSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7SUFDakMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxDQUFDO0lBRUosRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsSUFBSTtRQUN2QixNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDakMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDN0IsSUFBSSxFQUFFLENBQUM7SUFDWCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRTtRQUMxQixJQUFJLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUN6RixNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDOUQsQ0FBQyxDQUFBLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDO0FBSUgsUUFBUSxDQUFDLFlBQVksRUFBRTtJQUVuQixJQUFJLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO0lBQ3ZCLE1BQU0sQ0FBQyxDQUFDO1FBQ0osSUFBSSxNQUFNLEdBQUcsTUFBTSxNQUFNLENBQUMsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ25FLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDakMsSUFBSSxTQUFTLEdBQUcsTUFBTSxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixHQUFHLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNqRixNQUFNLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFN0QsSUFBSSxVQUFVLEdBQUcsTUFBTSxlQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFDLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDO1FBRXZCLElBQUksR0FBRztZQUNILE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsZ0JBQWdCO1lBQ3pDLFNBQVMsRUFBRSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUM7WUFDdkQsWUFBWSxFQUFFLEtBQUs7WUFDbkIsWUFBWSxFQUFFLE1BQU07WUFDcEIsY0FBYyxFQUFFLElBQUk7WUFDcEIsV0FBVyxFQUFFLE1BQU07WUFDbkIsVUFBVSxFQUFFLE1BQU07WUFDbEIsU0FBUyxFQUFFLFdBQVc7WUFDdEIsTUFBTSxFQUFFLElBQUk7WUFDWixRQUFRLEVBQUUsTUFBTTtZQUNoQixnQkFBZ0IsRUFBRSxDQUFDO1NBQ3RCLENBQUE7SUFDTCxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUM7SUFHSixFQUFFLENBQUMsMEJBQTBCLEVBQUU7UUFFM0IsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxPQUFPLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDMUIsSUFBSSxNQUFNLEdBQUcsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQzthQUMxQyxJQUFJLENBQUMsT0FBTyxDQUFDO2FBQ2IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywwQkFBMEIsRUFBRTtRQUMzQixJQUFJLE9BQU8sR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7YUFDMUMsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNiLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXJDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2pELElBQUksT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7YUFDM0MsSUFBSSxDQUFDLE9BQU8sQ0FBQzthQUNiLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRXpDLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMseUJBQXlCLEVBQUU7UUFDMUIsSUFBSSxNQUFNLEdBQUcsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQzthQUMxQyxJQUFJLENBQUMsSUFBSSxDQUFDO2FBQ1YsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3JCLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDdEMsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRTtRQUNyQyxJQUFJLENBQUMsS0FBSyxHQUFHLHlCQUF5QixDQUFDO1FBQ3ZDLElBQUksTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUM7YUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQzthQUNWLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVyQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUMsQ0FBQSxDQUFDLENBQUE7QUFDTixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBAQXV0aG9yOiBoZUB3aGFsZWJsdWUuZGVzaWduXG4gKiBARGF0ZTogMjAxOC0wNy0xNCAyMjo0Njo0MFxuICogQExhc3QgTW9kaWZpZWQgYnk6IE1yLkhlXG4gKiBATGFzdCBNb2RpZmllZCB0aW1lOiAyMDE4LTA3LTE3IDIyOjI3OjMzXG4gKiBAY29udGVudCB3aGF0IGlzIHRoZSBjb250ZW50IG9mIHRoaXMgZmlsZS4gKi9cblxuaW1wb3J0IGZzID0gcmVxdWlyZShcImZzXCIpO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcImNvbmZpZy9jb25maWdcIjtcbmltcG9ydCB7IGluaXQsIERCIH0gZnJvbSBcImNvbW1vbi9kYlwiO1xuaW1wb3J0IGNhY2hlIGZyb20gXCJjb21tb24vY2FjaGVcIjtcbmltcG9ydCAqIGFzIF8gZnJvbSBcImxvZGFzaFwiO1xuXG4vKiBpbml0IERCLCBpbXBvcnQgdGFibGUgbW9kZWxzLiAqL1xuaW5pdChjb25maWcubXlzcWwudXJsLCBjb25maWcubXlzcWwuZGVidWcpO1xuaW1wb3J0IFwic3FsTW9kZWwvaW5kZXhcIjtcbkRCLnN5bmMoeyBmb3JjZTogZmFsc2UgfSk7XG5cbi8qIGluamVjdCByZWRpcyBzZXJ2ZXIuICovXG5jYWNoZS5pbml0KGNvbmZpZy5yZWRpcy51cmwpO1xuXG5pbXBvcnQgYXBwIGZyb20gXCIuLi9odHRwXCI7XG5jb25zdCBzdXBlcmtvYSA9IHJlcXVpcmUoJ3N1cGVya29hJylcbmNvbnN0IGJvb3R1cCA9IHN1cGVya29hKGFwcCk7XG5jb25zdCBIVFRQX09LID0gMjAwO1xuY29uc3QgSFRUUF9FUlIgPSA1MDA7XG5cblxuaW1wb3J0ICogYXMgYXNzZXJ0IGZyb20gXCJhc3NlcnRcIjtcbmRlc2NyaWJlKCcjdGhlIGltYWdlIGNhcHRjaGEgdGVzdCcsIGZ1bmN0aW9uICgpIHtcblxuICAgIGxldCBjb2RlSWRCb2R5LCBjb2RlSWREYXRhO1xuICAgIGJlZm9yZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgYm9vdHVwLmdldChcIi9hcGkvdjEvY2FwdGNoYWlkXCIpLmV4cGVjdChIVFRQX09LKTtcbiAgICAgICAgY29kZUlkQm9keSA9IHJlc3VsdC5ib2R5O1xuICAgICAgICBjb2RlSWREYXRhID0gY29kZUlkQm9keS5kYXRhO1xuICAgIH0pKTtcblxuICAgIGl0KFwiZ2V0IHRoZSBjb2RlIElEXCIsIChkb25lKSA9PiB7XG4gICAgICAgIGFzc2VydC5lcXVhbChjb2RlSWRCb2R5LmNvZGUsIDApO1xuICAgICAgICBhc3NlcnQub2soY29kZUlkRGF0YS5jb2RlSWQpO1xuICAgICAgICBkb25lKCk7XG4gICAgfSk7XG5cbiAgICBpdChcImdldCB0aGUgY2FwdGNoYSBwaWN0dXJlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IGJvb3R1cC5nZXQoXCIvYXBpL3YxL2NhcHRjaGFpbWcvXCIgKyBjb2RlSWREYXRhLmNvZGVJZCkuZXhwZWN0KEhUVFBfT0spO1xuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LmhlYWRlcnNbXCJjb250ZW50LXR5cGVcIl0sIFwiaW1hZ2UvZ2lmXCIpO1xuICAgIH0pO1xufSk7XG5cblxuXG5kZXNjcmliZSgnI3Bvc3QgdXNlcicsIGZ1bmN0aW9uICgpIHtcblxuICAgIGxldCBjb2RlSWQsIGNvZGUsIGRhdGE7XG4gICAgYmVmb3JlKChhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBib290dXAuZ2V0KFwiL2FwaS92MS9jYXB0Y2hhaWRcIikuZXhwZWN0KEhUVFBfT0spO1xuICAgICAgICBjb2RlSWQgPSByZXN1bHQuYm9keS5kYXRhLmNvZGVJZDtcbiAgICAgICAgbGV0IGltZ3Jlc3VsdCA9IGF3YWl0IGJvb3R1cC5nZXQoXCIvYXBpL3YxL2NhcHRjaGFpbWcvXCIgKyBjb2RlSWQpLmV4cGVjdChIVFRQX09LKTtcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGltZ3Jlc3VsdC5oZWFkZXJzW1wiY29udGVudC10eXBlXCJdLCBcImltYWdlL2dpZlwiKTtcblxuICAgICAgICBsZXQgcmVkaXNDYWNoZSA9IGF3YWl0IGNhY2hlLnJlYWQoY29kZUlkKTtcbiAgICAgICAgY29kZSA9IHJlZGlzQ2FjaGUuY29kZTtcblxuICAgICAgICBkYXRhID0ge1xuICAgICAgICAgICAgXCJlbWFpbFwiOiBNYXRoLnJhbmRvbSgpICsgXCJhYmMxMjNAMTYzLmNvbVwiLFxuICAgICAgICAgICAgXCJhZGRyZXNzXCI6IFtcImRmZGZcIiwgXCJkZmRmZGZcIiwgXCJkZmRmZGZqZGxqY1wiLCBcImFhXCIsIFwiYlwiXSxcbiAgICAgICAgICAgIFwidHd0dGVyTmFtZVwiOiBcImRkZlwiLFxuICAgICAgICAgICAgXCJyYWRkaXROYW1lXCI6IFwiZGZkZlwiLFxuICAgICAgICAgICAgXCJmYWNlYm9va05hbWVcIjogXCJva1wiLFxuICAgICAgICAgICAgXCJmaXJzdE5hbWVcIjogXCJvMTIyXCIsXG4gICAgICAgICAgICBcImxhc3ROYW1lXCI6IFwibGFzdFwiLFxuICAgICAgICAgICAgXCJjb3VudHJ5XCI6IFwiY291bnRyeTEyXCIsXG4gICAgICAgICAgICBcImNvZGVcIjogY29kZSxcbiAgICAgICAgICAgIFwiY29kZUlkXCI6IGNvZGVJZCxcbiAgICAgICAgICAgIFwiY2hlY2tNYXJrZXRpbmdcIjogMVxuICAgICAgICB9XG4gICAgfSkpO1xuXG5cbiAgICBpdChcInRoZSBwYXJhbXMgcmVxdWlyZSBjaGVja1wiLCBhc3luYyAoKSA9PiB7XG5cbiAgICAgICAgbGV0IHRoZURhdGEgPSBfLmNsb25lRGVlcChkYXRhKTtcbiAgICAgICAgZGVsZXRlIHRoZURhdGEudHd0dGVyTmFtZTtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0IGJvb3R1cC5wb3N0KFwiL2FwaS92MS91c2Vyc1wiKVxuICAgICAgICAgICAgLnNlbmQodGhlRGF0YSlcbiAgICAgICAgICAgIC5leHBlY3QoSFRUUF9PSyk7XG4gICAgICAgIGFzc2VydC5ub3RFcXVhbChyZXN1bHQuYm9keS5jb2RlLCAwKTtcbiAgICB9KTtcblxuICAgIGl0KFwidGhlIHBhcmFtcyBhZGRyZXNzIGNoZWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHRoZURhdGEgPSBfLmNsb25lRGVlcChkYXRhKTtcbiAgICAgICAgdGhlRGF0YS5hZGRyZXNzID0gW107XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBib290dXAucG9zdChcIi9hcGkvdjEvdXNlcnNcIilcbiAgICAgICAgICAgIC5zZW5kKHRoZURhdGEpXG4gICAgICAgICAgICAuZXhwZWN0KEhUVFBfT0spO1xuICAgICAgICBhc3NlcnQubm90RXF1YWwocmVzdWx0LmJvZHkuY29kZSwgMCk7XG5cbiAgICAgICAgdGhlRGF0YS5hZGRyZXNzID0gW1wiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiLCBcIjVcIiwgXCI2XCJdO1xuICAgICAgICBsZXQgcmVzdWx0MiA9IGF3YWl0IGJvb3R1cC5wb3N0KFwiL2FwaS92MS91c2Vyc1wiKVxuICAgICAgICAgICAgLnNlbmQodGhlRGF0YSlcbiAgICAgICAgICAgIC5leHBlY3QoSFRUUF9PSyk7XG4gICAgICAgIGFzc2VydC5ub3RFcXVhbChyZXN1bHQuYm9keS5jb2RlLCAwKTtcblxuICAgIH0pO1xuXG4gICAgaXQoXCJ0aGUgdXNlciBjcmVhdGUgc3VjY2Vzc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCBib290dXAucG9zdChcIi9hcGkvdjEvdXNlcnNcIilcbiAgICAgICAgICAgIC5zZW5kKGRhdGEpXG4gICAgICAgICAgICAuZXhwZWN0KEhUVFBfT0spO1xuICAgICAgICBhc3NlcnQuZXF1YWwocmVzdWx0LmJvZHkuY29kZSwgMCk7XG4gICAgfSk7XG5cbiAgICBpdChcInRoZSBzYW1lIGNvZGUgY2FuJ3QgYmUgcG9zdCBhZ2Fpbi5cIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBkYXRhLmVtYWlsID0gXCJkZmRmZGZkZmRmZGZkZmRmQHFxLmNvbVwiO1xuICAgICAgICBsZXQgcmVzdWx0ID0gYXdhaXQgYm9vdHVwLnBvc3QoXCIvYXBpL3YxL3VzZXJzXCIpXG4gICAgICAgICAgICAuc2VuZChkYXRhKVxuICAgICAgICAgICAgLmV4cGVjdChIVFRQX09LKTtcblxuICAgICAgICBhc3NlcnQubm90RXF1YWwocmVzdWx0LmJvZHkuY29kZSwgMCk7XG4gICAgfSlcbn0pO1xuIl19